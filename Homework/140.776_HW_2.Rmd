---
title: "Project 2"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r warning = FALSE, message = FALSE}
library(tidyverse)
library(tidytuesdayR)
library(here)
```

# {.tabset}
## Part 1A

Let's create a function Exp(x) that approximates $e^x$:
\[\text{Exp}(x)=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+ \cdots\]

```{r}
Exp <- function(x, k){
  # approximate exp(x) with k terms
  sum = 1
  for(i in 1:k){
    sum = sum + x^i/factorial(i)
  }
  return(sum)
  
}
```

Cool! Let's test this out.

```{r}
Exp(2.3, 50)

# check
exp(2.3)
```
And we see that the two numbers match, so our function works as intended!

## Part 1B
Now, let's create functions to calculate the mean and standard deviation of a given set of $n$ observations $x_1,x_2,...,x_n$:

\begin{align*}
   \bar{x} &= \frac{1}{n}\sum_{i=1}^n{x_i} \\
   s &= \sqrt{\frac{1}{n-1}\sum_{i=1}^n{(x_i-\bar{x})^2}}
\end{align*}

```{r}
sample_mean <- function(x){
  N = length(x)
  sample_sum = sum(x)
  return(sample_sum / N)
}

sample_sd <- function(x){
  N = length(x)
  x_mean = sample_mean(x)
  sum_sqd = sum((sapply(x, "-", x_mean))^2)
  return(sqrt(sum_sqd/(N-1)))
}
```

```{r}
# specify mean = 1.5, sd = 2.5
x = rnorm(50000, 1.5, 2.5)

# check
sample_mean(x)
sample_sd(x)
```

And we see that the means and standard deviations match, so our functions work as intended!

## Part 1C
Using these mean and standard deviation functions, let's now create a function to estimate the confidence intervals for the estimate of the mean:
```{r}
calculate_CI <- function(x, conf = 0.95){
  alpha = 1 - conf
  df = length(x) - 1
  t_score <- qt(p = alpha / 2, df = df, lower.tail = FALSE)
  se_mean <- sample_sd(x) / sqrt(length(x))
  
  x_mean = sample_mean(x)
  lower_bound = x_mean - t_score * se_mean
  upper_bound = x_mean + t_score * se_mean
  
  return(c(lower_bound = lower_bound, upper_bound = upper_bound))
}
```

To test this function, we'll create a sample x.

```{r}
x <- rnorm(1000)

# code provided by Dr. Collado-Torres
dat <- data.frame(x = x)
fit <- lm(x ~ 1, dat)
```

Then, testing on $1 - \alpha = 0.95$,

```{r}
calculate_CI(x, conf = 0.95)
confint(fit, level = 0.95)
```

and on $1 - \alpha = 0.999$,

```{r}
calculate_CI(x, conf = 0.999)
confint(fit, level = 0.999)
```

we see that the confidence intervals match for both levels of $\alpha$, so our function works as intended!

## Part 2
First, let's import the data
```{r cache=TRUE}
if (!file.exists(here("data", "tuesdata_rainfall.RDS"))) {
    tuesdata <- tidytuesdayR::tt_load("2020-01-07")
    rainfall <- tuesdata$rainfall
    temperature <- tuesdata$temperature

    # save the files to RDS objects
    saveRDS(tuesdata$rainfall, file = here("data", "tuesdata_rainfall.RDS"))
    saveRDS(tuesdata$temperature, file = here("data", "tuesdata_temperature.RDS"))
}
```

Using this data, we will (do X)

```{r}
rainfall %>% 
  drop_na() %>% 
  unite("date", c(year, month, day), sep = "-", remove = FALSE) %>% 
  mutate(date = ymd(date)) %>% 
  select(-c(month, day))
```

